<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night Sky - Start Page</title>
    <link rel="stylesheet" href="css/page1.css">
</head>
<body>
    <div class="night"></div>
    <div class="light-glow"></div>
    <div class="stars" id="stars"></div>
    <div id="clouds"></div>

    <!-- Audio element (hidden) -->
    <audio id="backgroundMusic" loop>
        <source src="ERIK x FREAKY x BENNY - 'Y√™u B·ªÅn B·ªâ'  Official MV - ERIK Official.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="start-btn-container">
        <button class="start-btn" onclick="startJourney()">
            <svg class="btn-sparkle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path d="M10.5 1.5H8.25V3.75H10.5V1.5ZM1.5 10.5V8.25H3.75V10.5H1.5ZM13.5 1.5H15.75V3.75H13.5V1.5ZM22.5 10.5H20.25V8.25H22.5V10.5Z"></path>
                <path d="M10.5 13.5H8.25V15.75H10.5V13.5ZM1.5 22.5V20.25H3.75V22.5H1.5ZM13.5 13.5H15.75V15.75H13.5V13.5ZM22.5 22.5H20.25V20.25H22.5V22.5Z"></path>
            </svg>
            <span class="btn-text">B·∫Øt ƒê·∫ßu</span>
        </button>
    </div>

    <script>
        // Kh·ªüi t·∫°o v√† qu·∫£n l√Ω nh·∫°c n·ªÅn
        const audio = document.getElementById('backgroundMusic');
        let isFirstPlay = true; // Theo d√µi l·∫ßn ph√°t ƒë·∫ßu ti√™n
        
        // Kh√¥i ph·ª•c tr·∫°ng th√°i nh·∫°c khi trang t·∫£i
        window.addEventListener('load', function() {
            const isPlaying = localStorage.getItem('musicPlaying') === 'true';
            const currentTime = localStorage.getItem('musicTime');
            const volume = localStorage.getItem('musicVolume');
            
            // ƒê·∫∑t √¢m l∆∞·ª£ng m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥
            if (!volume) {
                audio.volume = 0.7;
                localStorage.setItem('musicVolume', '0.7');
            } else {
                audio.volume = parseFloat(volume);
            }
            
            // Kh√¥i ph·ª•c v·ªã tr√≠ ph√°t (ch·ªâ khi ƒë√£ t·ª´ng ph√°t tr∆∞·ªõc ƒë√≥)
            if (currentTime && isPlaying) {
                audio.currentTime = parseFloat(currentTime);
            }
            
            // KH√îNG t·ª± ƒë·ªông ph√°t nh·∫°c khi trang t·∫£i
            // Ch·ªâ ph√°t khi ng∆∞·ªùi d√πng click n√∫t "B·∫Øt ƒê·∫ßu"
            console.log('üéµ Nh·∫°c ƒë√£ s·∫µn s√†ng, ch·ªù ng∆∞·ªùi d√πng b·∫Øt ƒë·∫ßu');
        });

        // L∆∞u tr·∫°ng th√°i khi nh·∫°c ph√°t
        audio.addEventListener('play', function() {
            localStorage.setItem('musicPlaying', 'true');
            console.log('üéµ Nh·∫°c b·∫Øt ƒë·∫ßu ph√°t');
        });

        // L∆∞u tr·∫°ng th√°i khi nh·∫°c d·ª´ng
        audio.addEventListener('pause', function() {
            localStorage.setItem('musicPlaying', 'false');
            console.log('üéµ Nh·∫°c ƒë√£ d·ª´ng');
        });

        // L∆∞u th·ªùi gian hi·ªán t·∫°i ƒë·ªãnh k·ª≥
        setInterval(() => {
            if (!audio.paused) {
                localStorage.setItem('musicTime', audio.currentTime);
            }
        }, 2000);

        // L∆∞u √¢m l∆∞·ª£ng khi thay ƒë·ªïi
        audio.addEventListener('volumechange', function() {
            localStorage.setItem('musicVolume', audio.volume);
        });

        // H√†m b·∫Øt ƒë·∫ßu ph√°t nh·∫°c
        function startMusic() {
            return new Promise((resolve, reject) => {
                if (audio.paused) {
                    // ƒê·∫∑t th·ªùi gian b·∫Øt ƒë·∫ßu t·ª´ 0 n·∫øu l√† l·∫ßn ph√°t ƒë·∫ßu ti√™n
                    if (isFirstPlay) {
                        audio.currentTime = 0;
                        isFirstPlay = false;
                    }
                    
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('üéµ Nh·∫°c "Y√™u B·ªÅn B·ªâ" ƒëang ph√°t...');
                            resolve();
                        }).catch(error => {
                            console.log('‚ùå Kh√¥ng th·ªÉ ph√°t nh·∫°c:', error);
                            reject(error);
                        });
                    }
                } else {
                    // Nh·∫°c ƒëang ph√°t r·ªìi
                    resolve();
                }
            });
        }

        // T·∫°o sao
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 200; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            
            const size = Math.random() * 2 + 0.5;
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const delay = Math.random() * 3;
            
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.left = `${left}%`;
            star.style.top = `${top}%`;
            star.style.animationDelay = `${delay}s`;
            
            starsContainer.appendChild(star);
        }

        // T·∫°o m√¢y
        const cloudsContainer = document.getElementById('clouds');
        for (let i = 0; i < 5; i++) {
            const cloud = document.createElement('div');
            cloud.classList.add('cloud');
            
            const width = Math.random() * 200 + 100;
            const height = Math.random() * 80 + 40;
            const top = Math.random() * 50;
            const opacity = Math.random() * 0.1 + 0.05;
            const duration = Math.random() * 40 + 40;
            const delay = Math.random() * 20;
            
            cloud.style.width = `${width}px`;
            cloud.style.height = `${height}px`;
            cloud.style.top = `${top}%`;
            cloud.style.opacity = opacity;
            cloud.style.animationDuration = `${duration}s`;
            cloud.style.animationDelay = `${delay}s`;
            
            cloudsContainer.appendChild(cloud);
        }

        // H√†m chuy·ªÉn trang
        function startJourney() {
            // Th√™m hi·ªáu ·ª©ng loading cho button
            const button = document.querySelector('.start-btn');
            button.classList.add('loading');
            button.disabled = true;
            
            // C·∫≠p nh·∫≠t text button
            const btnText = button.querySelector('.btn-text');
            btnText.textContent = 'ƒêang kh·ªüi ƒë·ªông...';
            
            // B·∫Øt ƒë·∫ßu ph√°t nh·∫°c tr∆∞·ªõc khi chuy·ªÉn trang
            startMusic().then(() => {
                console.log('‚úÖ Nh·∫°c ƒë√£ b·∫Øt ƒë·∫ßu ph√°t, chu·∫©n b·ªã chuy·ªÉn trang...');
                
                // Chuy·ªÉn trang sau m·ªôt kho·∫£ng th·ªùi gian ng·∫Øn
                setTimeout(() => {
                    window.location.href = 'gift.html';
                }, 800);
            }).catch((error) => {
                console.log('‚ùå L·ªói khi ph√°t nh·∫°c, v·∫´n chuy·ªÉn trang...', error);
                
                // V·∫´n chuy·ªÉn trang n·∫øu kh√¥ng ph√°t ƒë∆∞·ª£c nh·∫°c
                setTimeout(() => {
                    window.location.href = 'gift.html';
                }, 500);
            });
        }

        // Kh·ªüi t·∫°o h·ªá th·ªëng nh·∫°c khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Trang ch·ªß ƒë√£ s·∫µn s√†ng');
            console.log('üéµ H·ªá th·ªëng nh·∫°c n·ªÅn ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o - Ch·ªù ng∆∞·ªùi d√πng b·∫Øt ƒë·∫ßu');
            
            // Th√™m s·ª± ki·ªán ƒë·ªÉ debug
            audio.addEventListener('canplaythrough', function() {
                console.log('‚úÖ Nh·∫°c ƒë√£ t·∫£i xong v√† s·∫µn s√†ng ph√°t');
            });
            
            audio.addEventListener('waiting', function() {
                console.log('‚è≥ Nh·∫°c ƒëang t·∫£i...');
            });
        });
    </script>

    <style>
        /* ·∫®n audio element */
        #backgroundMusic {
            display: none;
        }
        
        /* Th√™m hi·ªáu ·ª©ng loading cho button khi click */
        .start-btn.loading {
            position: relative;
            overflow: hidden;
        }
        
        .start-btn.loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: loading 1.5s infinite;
        }
        
        .start-btn:disabled {
            opacity: 0.8;
            cursor: not-allowed;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Hi·ªáu ·ª©ng cho button text khi loading */
        .btn-text {
            transition: all 0.3s ease;
        }
    </style>
</body>
</html>